# refinance
![logo](docs/refinance-logo.jpg)

refined financial system for a hackerspace. simple by design.

## architecture

### entity
anything that can send or receive money: human, donate-box, rent, utility.

### transaction
move X from A to B. supports all currencies.
- non-confirmed
- confirmed

### balance
sum of all transactions. both confirmed and not. separated.

### tags
mark entities and transactions for quick search.

### security
`X-Token` header is used for authentication.

token will be sent to `telegram_id` of an entity. newly generated tokens do not revoke old ones.

you may request a new token any time: with `name`, `id` or `telegram_id` of your entity — anything you remember.

> token — [jwt](http://jwt.io) with entity id & timestamp inside. basically it's a server-signed & verifiable json, base64'd.

## run
you need to put configure secrets into file `secrets.env`. see `secrets.env.example` as a reference. 

```console
docker compose up
```
API: http://localhost:8000/docs
UI: http://localhost:5000


## develop
run backend & frontend with live code reload:
```
docker compose -f docker-compose.yml -f docker-compose.dev.yml up
```
open http://localhost:8000/docs and http://localhost:5000

create local environment with all dependencies:
```console
pipenv install --dev
```
- open any .py file in vscode
- choose newly created env as python interpreter (bottom right button)
- now vscode intellisense will work correctly for all packages

if you need to change the Pipfile:
```console
pipenv requirements --exclude-markers --dev > requirements.txt
cp requirements.txt ui
cp requirements.txt api
```

to run api tests:
```
pipenv shell
cd api
pytest
```


## todo
- [x] base classes
- [x] errors
- [x] unit tests
- [x] complex search
- [x] pagination
- [x] tags
- [x] transactions
- [x] balances
- [x] balance cache
- [x] date range search
- [ ] recurrent payments
- [ ] donation categories
- [ ] migrations (not alembic?)
- [ ] logging
- [x] docker
- [ ] grafana, statistics
- [x] authentication?
- [ ] permissions?
- [x] pytest ci

## tests notice
tests are mostly autogenerated by llm, given the route and schema. human review would be beneficial. 

## license
MIT
