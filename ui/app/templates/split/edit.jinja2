{% extends 'base.jinja2' %}
{% from 'widgets/entity_selector.jinja2' import entity_selector %}
{% from 'widgets/tag_selector.jinja2' import tag_selector %}
{% from 'form.jinja2' import render_form %}

{% block title %}Edit split {{ split.id }}{% endblock %}

{% block content %}
<form method="post">
    <table>
        <tr>
            <td>{{ form.recipient_entity_name.label }}</td>
            <td>
                {{ entity_selector('recipient_entity', split.recipient_entity.name, split.recipient_entity.id) }}
            </td>
        </tr>
        {{ render_form(form, except=('recipient_entity_name', 'recipient_entity_id', 'tag_ids'), new_table=False) }}
        {# <tr>
            <td>Tags</td>
            <td>{{ tag_selector('tag_ids', all_tags, form.tag_ids.data or []) }}</td>
        </tr> #}
    </table>
</form>

<script src="/static/js/entitySelector.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const currencySelect = document.getElementById('currency');
    const customCurrencyField = document.getElementById('custom_currency');
    const customCurrencyRow = customCurrencyField ? customCurrencyField.closest('tr') : null;
    
    function toggleCustomCurrency() {
        if (currencySelect && customCurrencyRow && customCurrencyField) {
            if (currencySelect.value === 'other') {
                customCurrencyRow.style.display = '';
                customCurrencyField.required = true;
            } else {
                customCurrencyRow.style.display = 'none';
                customCurrencyField.required = false;
            }
        }
    }
    
    if (currencySelect) {
        currencySelect.addEventListener('change', toggleCustomCurrency);
        // Initial state - show if "other" is selected
        toggleCustomCurrency();
    }
});
</script>
{% endblock %}